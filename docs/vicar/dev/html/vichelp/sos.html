<HTML>
<HEAD><title>HTML Help for SOS</title></HEAD>
<BODY>
<H1>Help for SOS</H1>
<pre>
PURPOSE:

	Removes <A HREF="/VICAR-DOCS/vicar/dev/html/vichelp/sos_level2.html#camera">camera</A> shading from images by assuming a linear transfer
 curve, with coefficients for each pixel in image space. Shading correction
 coefficients for each pixel are generated by "sosgen". These coefficients
 are applied by "sos" to remove <A HREF="/VICAR-DOCS/vicar/dev/html/vichelp/sos_level2.html#camera">camera</A> shading from individual frames. These
 programs are intended for use with the Viking Orbiter VIS system.

	There have been modifications made to "sos". Two of them are directed
 at controlling the contrast of the output picture by introducing <A HREF="/VICAR-DOCS/vicar/dev/html/vichelp/sos_level2.html#scale">scale</A> and
 auto-<A HREF="/VICAR-DOCS/vicar/dev/html/vichelp/sos_level2.html#stretch">stretch</A> parameters. The rest of the changes apply only to Viking Orbiter
 frames and involved parameters to override information in the VO label and a
 modification to subtract the dark current from frames for which the D.C.
 <A HREF="/VICAR-DOCS/vicar/dev/html/vichelp/sos_level2.html#offset">offset</A> has been turned off. All parameters are optional and may be specified
 in any order.

OPERATION:

	Shading correction coefficients are generated by "sosgen" using
 calibration data consisting of a sequence of flat-field frames taken at
 increasing levels of illumination. Only frames taken at exposures within
 the linear portion of the light-transfer curve should be used (see IOM
 324-IPL/71-843 by J. B. Seidman and A. A. Schwartz, "First Order Photometric
 Correction," 9 June 1971).

	A modification has been made to subract the dark current from all
 Viking Orbiter frames taken with the D.C. <A HREF="/VICAR-DOCS/vicar/dev/html/vichelp/sos_level2.html#offset">offset</A> turned off before applying
 the shading correction transformation (reference c). This is accomplished
 by subtracting a constant K from all samples in the input frame. The values
 for K are given in Table 1. (The parameter <A HREF="/VICAR-DOCS/vicar/dev/html/vichelp/sos_level2.html#dc">DC</A> is specified.)

		_______________________________________________
		|	|	     |	<A HREF="/VICAR-DOCS/vicar/dev/html/vichelp/sos_level2.html#offset">OFFSET</A> VALUE(K)       |
		|  S/C	| <A HREF="/VICAR-DOCS/vicar/dev/html/vichelp/sos_level2.html#camera">CAMERA</A> S/N |------------------------|
		|  	|	     | 	HIGH <A HREF="/VICAR-DOCS/vicar/dev/html/vichelp/sos_level2.html#gain">GAIN</A> | LOW GAIN  |
		|-------|------------|------------|-----------|
		|	|	     |		  |	      |
		| VO-1A |      7     |     90	  |	45    |
		|_______|____________|____________|___________|
		|	|	     |		  |	      |
		| VO-1B |      4     |     50	  |	25    |
		|_______|____________|____________|___________|
		|	|	     |		  |	      |
		| VO-2A |      8     |     62	  |	31    |
		|_______|____________|____________|___________|
		|	|	     |		  |	      |
		| VO-2B |      6     |     62	  |	31    |
		|_______|____________|____________|___________|

	The basic reason for adjusting the picture contrast within the program 
 rather than during a subsequent job step is to reduce the contouring which
 occurs when an underexposed frame is severely stretched. This contouring is
 primarily caused by the bit truncation error which results when brightness
 information is recorded over a narrow DN range. The <A HREF="/VICAR-DOCS/vicar/dev/html/vichelp/sos_level2.html#scale">scale</A> and ASTRETCH options
 are designed to broaden the DN range of the output picture. What follows is
 a brief description of the shading correction algorithm (see referenc a) and
 how it is modified by the <A HREF="/VICAR-DOCS/vicar/dev/html/vichelp/sos_level2.html#scale">SCALE</A> and ASTRETCH options.

 	<A HREF="/VICAR-DOCS/vicar/dev/html/vichelp/sos_level2.html#camera">Camera</A> induced shading is removed from a picture by first determining
 the light transfer funciton (assumed to be linear) relating image DN
 (x sub ij) to ovject scene luminance (l sub ij). The inverse light tranfer
 function may be approximated as follows:

		l   = m* x  + b*
		 ij    ij ij   ij

	Each pixel in the image is restored to its original object scene
 luminance, and the result scaled as follows:

		y   = s (m* x   + b* )				(1)
		 ij    o  ij ij    ij
 where
		y   = corrected output DN
		 ij

		     mean object scene luminance
		s  = ---------------------------
		 o         mean image DN

	The shading coefficients are generated by the VICAR program "sos"GEN
 and stored in a calibration file as ordered pairs (m' sub ij,b' sub ij), where
 
	m'  = 4096m* s		and	b'  = 16m* s
	 ij        ij o			 ij      ij o

	The shading correction actually performed by "sos" thus involves the 
 following steps:
			y   = ((m'  * x  )/intercept + b' ) / 16
			 ij      ij    ij         ij

 where intercept is 256 for HI <A HREF="/VICAR-DOCS/vicar/dev/html/vichelp/sos_level2.html#gain">gain</A> images and 128 from LO gain images.

	Dropping the subscripts:
			y = ((m'*x)/intercept + b')/16		(2)

	Truncation errors are introduced at the two division steps (all
 calculations are performed using integer variables). When the <A HREF="/VICAR-DOCS/vicar/dev/html/vichelp/sos_level2.html#scale">SCALE</A> parameter
 S is used, equation 2 is modified as follows:

		y  = S' * (m*x + intercept *b)
		 s
	where
		S' = S/4096

	When the ASTRETCH option is used, equation 2 is modified as follows:
 First, a histogram is generated by performing the foillowing transformation
 over a sub-sampling o the input picture:

		y' = (m' * x) / intercept + b'

RESTRICTIONS:

	"sos" is currently restricted to byte pictures of smaple size no larger
 than 1204. Because of the format of the generated coefficients, the allowable
 range of values are |m  | &lt 8 and |b  | < 2048.
		     | ij|	   | ij|

HISTORY:

  WRITTEN BY:  G.M.Yagi,  19 Oct. 1979

  CONVERTED TO VAX BY: C.C.Avis,  10 June 84

08 MAY 95   ...AMS...    (CRI) Made portable for UNIX
10 JUL 91   ...CCA...    Modified to use new VOLABV2
19 AUG 88   ...HBM...    Fixed intercept for LO <A HREF="/VICAR-DOCS/vicar/dev/html/vichelp/sos_level2.html#gain">gain</A> images
10 JUN 84   ...CCA...    CONVERT TO VAX
10 APR 81   ...GMY...    FIX ASTRTCH OPTION FOR LOW <A HREF="/VICAR-DOCS/vicar/dev/html/vichelp/sos_level2.html#gain">GAIN</A>
19 OCT 79   ...GMY...    INITIAL RELEASE

</pre>
<hr>
<H2>PARAMETERS:</H2>
<HR><A HREF="/VICAR-DOCS/vicar/dev/html/vichelp/sos_level2.html#inp"><H3>INP</H3></A>
STRING-Input file name.
<HR><A HREF="/VICAR-DOCS/vicar/dev/html/vichelp/sos_level2.html#out"><H3>OUT</H3></A>
STRING-Output file name.
<HR><A HREF="/VICAR-DOCS/vicar/dev/html/vichelp/sos_level2.html#dbug"><H3>DBUG</H3></A>
KEYWORD-Debugging statements
for programmers use.
<HR><A HREF="/VICAR-DOCS/vicar/dev/html/vichelp/sos_level2.html#phist"><H3>PHIST</H3></A>
KEYWORD-Prints histogram.
<HR><A HREF="/VICAR-DOCS/vicar/dev/html/vichelp/sos_level2.html#noise"><H3>NOISE</H3></A>
KEYWORD-
<HR><A HREF="/VICAR-DOCS/vicar/dev/html/vichelp/sos_level2.html#mode"><H3>MODE</H3></A>
KEYWORD-
<HR><A HREF="/VICAR-DOCS/vicar/dev/html/vichelp/sos_level2.html#camera"><H3>CAMERA</H3></A>
INTEGER-<A HREF="/VICAR-DOCS/vicar/dev/html/vichelp/sos_level2.html#camera">Camera</A> serial number.
<HR><A HREF="/VICAR-DOCS/vicar/dev/html/vichelp/sos_level2.html#filter"><H3>FILTER</H3></A>
INTEGER-<A HREF="/VICAR-DOCS/vicar/dev/html/vichelp/sos_level2.html#filter">Filter</A> position.
<HR><A HREF="/VICAR-DOCS/vicar/dev/html/vichelp/sos_level2.html#gain"><H3>GAIN</H3></A>
INTEGER-<A HREF="/VICAR-DOCS/vicar/dev/html/vichelp/sos_level2.html#gain">Gain</A> state.
<HR><A HREF="/VICAR-DOCS/vicar/dev/html/vichelp/sos_level2.html#offset"><H3>OFFSET</H3></A>
INTEGER-Dark current <A HREF="/VICAR-DOCS/vicar/dev/html/vichelp/sos_level2.html#offset">offset</A> on or
off.
<HR><A HREF="/VICAR-DOCS/vicar/dev/html/vichelp/sos_level2.html#dc"><H3>DC</H3></A>
INTEGER-Dark current <A HREF="/VICAR-DOCS/vicar/dev/html/vichelp/sos_level2.html#offset">offset</A>.
<HR><A HREF="/VICAR-DOCS/vicar/dev/html/vichelp/sos_level2.html#lperc"><H3>LPERC</H3></A>
REAL-Percentage of output samples
to be saturated to 0 DN.
<HR><A HREF="/VICAR-DOCS/vicar/dev/html/vichelp/sos_level2.html#hperc"><H3>HPERC</H3></A>
REAL-Percentage of output samples
to be saturated to 255 DN.
<HR><A HREF="/VICAR-DOCS/vicar/dev/html/vichelp/sos_level2.html#linc"><H3>LINC</H3></A>
INTEGER-Line increment.
<HR><A HREF="/VICAR-DOCS/vicar/dev/html/vichelp/sos_level2.html#sinc"><H3>SINC</H3></A>
INTEGER-Sample increment.
<HR><A HREF="/VICAR-DOCS/vicar/dev/html/vichelp/sos_level2.html#ihist"><H3>IHIST</H3></A>
KEYWORD-
<HR><A HREF="/VICAR-DOCS/vicar/dev/html/vichelp/sos_level2.html#exclude"><H3>EXCLUDE</H3></A>
INTEGER-
<HR><A HREF="/VICAR-DOCS/vicar/dev/html/vichelp/sos_level2.html#stretch"><H3>STRETCH</H3></A>
INTEGER-Causes a linear <A HREF="/VICAR-DOCS/vicar/dev/html/vichelp/sos_level2.html#stretch">stretch</A> to
be performed.
<HR><A HREF="/VICAR-DOCS/vicar/dev/html/vichelp/sos_level2.html#scale"><H3>SCALE</H3></A>
REAL-Each element in the output
picture will be multiplied by the
constant term S.
<HR><A HREF="/VICAR-DOCS/vicar/dev/html/vichelp/sos_level2.html#skale"><H3>SKALE</H3></A>
REAL-
<HR><A HREF="/VICAR-DOCS/vicar/dev/html/vichelp/sos_level2.html#tnoise"><H3>TNOISE</H3></A>
INTEGER-test <A HREF="/VICAR-DOCS/vicar/dev/html/vichelp/sos_level2.html#noise">noise</A> value
<HR><A HREF="/VICAR-DOCS/vicar/dev/html/vichelp/sos.html#examples"><H4>See Examples:</H4></A>
<HR><A HREF="/VICAR-DOCS/vicar/dev/html/vichelp/sos.html#CogProg"><H4>Cognizant Programmer:</H4></A>
</BODY>
</HTML>
