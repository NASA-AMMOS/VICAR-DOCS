<HTML>
<HEAD><title>HTML Help for GEOMZ</title></HEAD>
<BODY>
<H1>Help for GEOMZ</H1>
<pre>
 PURPOSE:

Program "geomz" is a VICAR applications program which is used to 
perform vertical (brightness or DN) correction of images by a set of
points specified as parameters or in a parameter data set.
"geomz" does not perform a geometric transformation (of line and sample 
coordinates) of the image.
 EXECUTION:

"geomz" is designed to be an analog of program "GEOMA".  Its application is
for vertical (brightness or DN) manipulations of images.  Vertical corrections
are specified by the user through tiepoints either as parameters or in a 
parameter file.  (Program "TIECONM" can produce a parameter file for "geomz".)
The "GEOMA" execution format has been imitated as closely as possible.

The <A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/geomz_level2.html#size">size</A> of the output image is determined by the number of lines and number 
of samples in the <A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/geomz_level2.html#size">SIZE</A> field if the SIZE field is entered by the user.  If the
<A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/geomz_level2.html#size">SIZE</A> field is not entered, the output file is the same size as the input file.

The data type of the input image may either be byte or halfword data.
The data type is obtained from the VICAR label of the input image.
The output image has the same data format  (byte or halfword) as the input 
image.  
TAE COMMAND LINE FORMAT
      The following command line formats show the major allowable forms:
      geomz <A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/geomz_level2.html#inp">INP</A>=a <A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/geomz_level2.html#out">OUT</A>=b <A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/geomz_level2.html#size">SIZE</A>=(<A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/geomz_level2.html#sl">sl</A>,<A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/geomz_level2.html#ss">ss</A>,<A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/geomz_level2.html#nl">nl</A>,<A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/geomz_level2.html#ns">ns</A>) parameters
      geomz <A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/geomz_level2.html#inp">INP</A>=a <A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/geomz_level2.html#out">OUT</A>=b  <A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/geomz_level2.html#sl">SL</A>=sl <A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/geomz_level2.html#ss">SS</A>=ss <A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/geomz_level2.html#nl">NL</A>=nl <A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/geomz_level2.html#ns">NS</A>=ns parameters
      geomz a b (<A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/geomz_level2.html#sl">sl</A>,<A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/geomz_level2.html#ss">ss</A>,<A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/geomz_level2.html#nl">nl</A>,<A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/geomz_level2.html#ns">ns</A>) parameters
      geomz a b parameters
      geomz <A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/geomz_level2.html#inp">INP</A>=a <A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/geomz_level2.html#out">OUT</A>=b <A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/geomz_level2.html#size">SIZE</A>=(<A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/geomz_level2.html#sl">sl</A>,<A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/geomz_level2.html#ss">ss</A>,<A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/geomz_level2.html#nl">nl</A>,<A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/geomz_level2.html#ns">ns</A>) <A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/geomz_level2.html#parms">PARMS</A>=c optional parameters
      geomz <A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/geomz_level2.html#inp">INP</A>=a <A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/geomz_level2.html#out">OUT</A>=b  <A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/geomz_level2.html#sl">SL</A>=sl <A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/geomz_level2.html#ss">SS</A>=ss <A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/geomz_level2.html#nl">NL</A>=nl <A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/geomz_level2.html#ns">NS</A>=ns <A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/geomz_level2.html#parms">PARMS</A>=c optional parameters
      geomz a b (<A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/geomz_level2.html#sl">sl</A>,<A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/geomz_level2.html#ss">ss</A>,<A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/geomz_level2.html#nl">nl</A>,<A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/geomz_level2.html#ns">ns</A>) <A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/geomz_level2.html#parms">PARMS</A>=c optional parameters
      geomz a b <A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/geomz_level2.html#parms">PARMS</A>=c optional parameters

       Here 'a' represents the input image file name,
       'b' represents the output image file name,
       and 'c' represents the parameter file name.
The <A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/geomz_level2.html#tiepoint">tiepoint</A> grid must be specified as as set of parameters either in the
TAE command line or in the parameter file.
The <A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/geomz_level2.html#tiepoint">tiepoint</A> grid is specified using the parameters <A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/geomz_level2.html#nah">NAH</A>, <A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/geomz_level2.html#nav">NAV</A>, and TIEPOINT.

   <A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/geomz_level2.html#nah">NAH</A>=nah  <A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/geomz_level2.html#nav">NAV</A>=nav <A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/geomz_level2.html#tiepoint">TIEPOINT</A>=( L1,S1,DZ1  L2,S2,DZ2 ... )

<A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/geomz_level2.html#nah">nah</A> is the number of grid cells horizontally (across the top in the sample
direction), <A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/geomz_level2.html#nav">nav</A> is the number of grid cells vertically. The grid must be
evenly-spaced and perfectly rectangular and the rows and columns must be
perfectly horizontal and vertical respectively. 
<A NAME="examples">EXAMPLE</A>

       geomz <A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/geomz_level2.html#inp">INP</A>=A <A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/geomz_level2.html#out">OUT</A>=B <A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/geomz_level2.html#size">SIZE</A>=(1,1,500,1000)  <A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/geomz_level2.html#nah">NAH</A>=1 <A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/geomz_level2.html#nav">NAV</A>=1  <A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/geomz_level2.html#fixval">FIXVAL</A>=0                 <A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/geomz_level2.html#tiepoint">TIEPOINT</A>=(   1,1,10      1,1000, -10                          500,1,10    500,1000, -10   )

This example cause the input to be changed by a ramp function with the
leftmost pixels becoming 10 DN brighter and the rightmost pixels becoming
10 DN dimmer.  Pixels with a 0 value in A are not changed because of the
<A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/geomz_level2.html#fixval">FIXVAL</A> parameter.
RESTRICTIONS
1. The input and output images must be byte or halfword data.
2. The maximum number of pixels per line is 60,000.
3. The maximum number of tiepoints is 40,000.  (If parameters are used 
   instead of a parameter file, the limit is 200.)
4. The maximum value for <A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/geomz_level2.html#nah">NAH</A> is 200.
5. The maximum value for <A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/geomz_level2.html#nav">NAV</A> is 3000
 OPERATION:

The input picture is transformed pixel by pixel to the output picture by
adjusting the DN value according to nearby tiepoints.  A four (<A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/geomz_level2.html#nah">NAH</A>) by 
three (<A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/geomz_level2.html#nav">NAV</A>) <A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/geomz_level2.html#tiepoint">tiepoint</A> grid is illustrated below.  The tiepoints are marked 
with a '+' character.  The lines show how areas are defined by the grid.
A pixel within an area is adjusted according to the four tiepoints that
define the area containing that pixel.  Usually, this is a rectangle 
containing the pixel; but if the point lies outside the convex hull of the
grid, then the nearest rectangle is used for adjustment.

                     |      |      |      
              +      +      +      +                            |      |      |      
        ------+------+------+------+------+------
                     |      |      |      
        ------+------+------+------+------+------
                     |      |      |      
              +      +      +      +                            |      |      |      

The DN adjustment is obtained by bilinear interpolation (or extrapolation)
of the adjustment at the four grid points.  The formula is

     DN (output) = DN (input) + ax + by + cxy + d

where x and y are the pixel coordinates and a,b,c,d are constants chosen
so that 

    delta DN(k) = ax(k) + by(k) + cx(k)y(k) + d          for k = 1,2,3,4,

where x(k) and y(k) are the coordinate values and delta DN(k) are the DN
shifts of the four selected tiepoints for the point x,y.

The calculation is performed by a double incrementing scheme.  For a single
line, the DN increment per pixel is given by  b+cx.  The starting values for
subsequent lines are incremented by  a+cy.  Thus the full solution is needed
only at the upper left corner of an area, and all other values are obtained
by incrementing.

After the delta-DN (DZ) values are added, the resulting DNs are then checked
for being valid for the data type (byte or halfword) of the image and are
adjusted if invalid.  For byte data, DNs less than 0 are set to 0, and DNs
greater than 255 are set to 255.  For halfword data, DNs less than 0 are set to
0, and DNs greater than 32767 are set to 32767. 

WRITTEN BY:                 Steve Pohorsky                1 May 1986

Original Programmer:        H. Wilczynski                 1 Sep 1977

<A NAME="CogProg">Cognizant Programmer:       Steve Pohorsky                1 May 1986</A>

Made portable for UNIX      VRU  (CRI)                    8 May 1995
</pre>
<hr>
<H2>PARAMETERS:</H2>
<HR><A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/geomz_level2.html#inp"><H3>INP</H3></A>
Input file name
<HR><A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/geomz_level2.html#out"><H3>OUT</H3></A>
Output file name
<HR><A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/geomz_level2.html#size"><H3>SIZE</H3></A>
Standard VICAR <A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/geomz_level2.html#size">Size</A> Field
<HR><A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/geomz_level2.html#sl"><H3>SL</H3></A>
Starting line for output
<HR><A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/geomz_level2.html#ss"><H3>SS</H3></A>
Starting sample for output
<HR><A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/geomz_level2.html#nl"><H3>NL</H3></A>
Number of lines for output
<HR><A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/geomz_level2.html#ns"><H3>NS</H3></A>
Number of samples for output
<HR><A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/geomz_level2.html#nah"><H3>NAH</H3></A>
number of grid
cells horizontally
<HR><A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/geomz_level2.html#nav"><H3>NAV</H3></A>
number of grid
cells vertically
<HR><A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/geomz_level2.html#tiepoint"><H3>TIEPOINT</H3></A>
grid corner tiepoints in
rows L1,S1,DZ1,L2,...
<HR><A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/geomz_level2.html#fixval"><H3>FIXVAL</H3></A>
a single DN value (optional)
to be left unchanged by the
DN transformation.
<HR><A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/geomz_level2.html#parms"><H3>PARMS</H3></A>
optional parameter file
<HR><A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/geomz.html#examples"><H4>See Examples:</H4></A>
<HR><A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/geomz.html#CogProg"><H4>Cognizant Programmer:</H4></A>
</BODY>
</HTML>
