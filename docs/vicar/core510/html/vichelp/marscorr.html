<HTML>
<HEAD><title>HTML Help for MARSCORR</title></HEAD>
<BODY>
<H1>Help for MARSCORR</H1>
<pre>
PURPOSE:
To compute, from a stereo pair of images, the line and sample disparity
of every pixel in the scene.  The output is typically run through the
program MARSXYZ to generate X,Y,Z coordinates over the entire image.

This is a general-purpose correlation program, which does not make use of
any pointing or camera model information.  The input images do not have to
be registered or epipolar aligned, as long as appropriate <A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/marscorr_level2.html#seed">seed</A> point(s) are
provided.

This program is derived from Mars Pathfinder's MPFTPT.

EXECUTION:
marscorr <A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/marscorr_level2.html#inp">inp</A>=(left,right) <A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/marscorr_level2.html#out">out</A>=(line_disparity,samp_disparity) <A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/marscorr_level2.html#mask">mask</A>=mask params

where:
left is the left eye image of a stereo pair
right is the corresponding right eye image of a stereo pair
line_disparity is the right eye line value, for each pixel in the left image.
samp_disparity is the right eye sample value, for each pixel in the left image.
<A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/marscorr_level2.html#mask">mask</A> is a completion status.  

Although "left" and "right" are used above, there is no actual restriction
that the first image be left and the second be right.  Correlations are done
from the first image to the second.  Output images (disparity and <A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/marscorr_level2.html#mask">mask</A>)
correspond to the first image, containing matching coordinates in the second
image.  However, for convenience, "left" and "right" are used throughout
this help.

Additionally, <A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/marscorr_level2.html#out_quality">out_quality</A> can be used to name an output file which will
contain the correlation qualities for each pixel.

METHOD:
A <A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/marscorr_level2.html#seed">seed</A> point is used as an initial guess to obtain an initial correlation,
using a wide <A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/marscorr_level2.html#search">search</A> area (defined by <A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/marscorr_level2.html#amax">AMAX</A>(2)).  A region is grown from the
<A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/marscorr_level2.html#seed">seed</A> outward in a spiral-like pattern until the picture is filled.

For each pixel, the 8 neighbors are examined to find the one with the best
correlation value so far.  This neighbor is used as the initial guess for
the pixel in question (modified +/-1 as appropriate).  If no correlated
neighbors are found, the pixel is skipped.  The correlation window is
defined via the <A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/marscorr_level2.html#template">TEMPLATE</A> and <A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/marscorr_level2.html#search">SEARCH</A> parameters.

Once the region has grown to the size of the image (or <A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/marscorr_level2.html#tptlimit">TPTLIMIT</A> pixels have
been correlated), a second pass goes through the region and attempts to
fill gores, or pixels that did not correlate on the first pass, by again
examining all of its neighbors (since neighbors on the other side, which
were not done previously, might provide a better starting location, which
will correlate, especially near edges).  This process continues until no
more gores are filled in a pass.

If an input tiepoint file (generated by MARSTIE) was provided, the tiepoints
in that file are used as multiple seeds.  The entire process above is repeated
in turn for each <A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/marscorr_level2.html#seed">seed</A>.  If a seed point has already been correlated via a
region grown from a previous <A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/marscorr_level2.html#seed">seed</A>, the new seed is ignored.  Multiple seed
points are good for areas separated from the rest of the image by large
disparity displacements or uncorrelateable areas such as undifferentiated
sand.

All correlations are performed using the gruen correlation routine.  See
the gruen documentation for details of the algorithm.  <A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/marscorr_level2.html#seed">Seed</A> points are
always correlated using <A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/marscorr_level2.html#mode">mode</A> 3 (linear followed by amoeba) to handle large
offsets.  The rest of the points may be correlated using any gruen <A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/marscorr_level2.html#mode">mode</A>
via the <A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/marscorr_level2.html#mode">MODE</A> parameter:

linear:            gruen <A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/marscorr_level2.html#mode">mode</A> 0
annealing:         gruen <A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/marscorr_level2.html#mode">mode</A> 1
amoeba:            gruen <A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/marscorr_level2.html#mode">mode</A> 2
linear_amoeba:     gruen <A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/marscorr_level2.html#mode">mode</A> 3
annealing_amoeba:  gruen <A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/marscorr_level2.html#mode">mode</A> 4
amoeba2:           gruen <A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/marscorr_level2.html#mode">mode</A> 5
linear_amoeba2:    gruen <A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/marscorr_level2.html#mode">mode</A> 6

Of the above, only amoeba and amoeba2 (modes 2 and 5) are recommended.  The
others are provided only for experimentation, and may significantly increase
the execution time of the program.  The annealing modes are not fully
implemented in the code at this time, but it would be trivial to do so if
desired.

The amoeba <A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/marscorr_level2.html#mode">mode</A> uses a full 6 degree of freedom <A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/marscorr_level2.html#search">search</A> from the starting point
(derived from the best neighbor).  The starting point must be within 2 pixels.
The amoeba2 <A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/marscorr_level2.html#mode">mode</A> uses only 2 degrees of freedom (x/y offsets only) so it will
be faster, at the possible expense of accuracy.  The starting point must also
be within 2 pixels.  amoeba2 is not recommended for images that are not derived
from a stereo camera, e.g. using different instruments or involving motion
between the two frames.  The other modes generally do not have a 2 pixels
starting point limitation, so they might be useful for scenes with wildly
varying disparity values.  However, they are so slow that it will usually be
better to supply multiple <A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/marscorr_level2.html#seed">seed</A> points in each area using MARSTIE.

The <A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/marscorr_level2.html#template">template</A> (correlation patch) and <A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/marscorr_level2.html#search">search</A> area sizes may be rectangular
instead of square.  For landed images such as Mars Pathfinder or the Mars 98
lander, it may be advantageous to specify areas that are much wider than
they are tall.

Output file contents:

All output files are in the coordinates of the first (left eye) image.
For example if the sample disparity file has a value of 56.67 at sample 50
it means that the sample location of a tiepoint located at sample 50 in the
left eye image corresponds to sample 56.67 in the right eye image.   

The line and sample disparities are normally in two separate files.  However,
if only one filename is provided, both are written to a single, 2-banded
file, with line in the first <A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/marscorr_level2.html#band">band</A> and sample in the second.

First output (or <A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/marscorr_level2.html#band">band</A>): A REAL image containing the line disparity.  The
line/sample coordinate of each pixel in the output defines the position
in the left eye.  The value of the pixel contains the line coordinate of
the corresponding pixel in the right eye image.

Second output (or <A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/marscorr_level2.html#band">band</A>): A REAL image containing the sample disparity.  The
line/sample coordinate of each pixel in the output defines the position
in the left eye.  The value of the pixel contains the sample coordinate of
the corresponding pixel in the right eye image.

If both line & sample disparity values are 0.000 the point has no value
(meaning correlation failed for that point).

Note that all disparity values use 1-based coordinates for the right
image, per VICAR conventions.

<A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/marscorr_level2.html#mask">Mask</A> file (optional): A BYTE image showing the coverage of tiepoints.
 0 dn means the pixel could not be reached in order to be correlated
   (i.e. there were no neighbors to supply an initial value, or <A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/marscorr_level2.html#tptlimit">TPTLIMIT</A>
   was reached).
 128 dn means a correlation was successfully performed at this location.
 255 dn means a correlation was attempted at this location but it failed,
   usually because of low correlation <A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/marscorr_level2.html#quality">quality</A>.

Output <A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/marscorr_level2.html#quality">quality</A> file (optional): A REAL image containing the correlation
<A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/marscorr_level2.html#quality">quality</A> of each pixel attempted, from 0 to 1.  0 indicates either a
correlation failure unrelated to the <A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/marscorr_level2.html#quality">QUALITY</A> setting, or a pixel that was
not reached (the <A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/marscorr_level2.html#mask">MASK</A> output can distinguish).  Note that the file will
contain just a thin border of poor-<A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/marscorr_level2.html#quality">quality</A> pixels around each area,
because poor-<A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/marscorr_level2.html#quality">quality</A> pixels prevent the correlator from searching farther
in that direction.

HISTORY:
12-1-95  Initial MPFTPT program by J Lorre. 
July 99  Signficant internal restructuring and addition of features.
         Program renamed to marscorr.  Bob Deen
<A NAME="CogProg">COGNIZANT PROGRAMMER:  Bob Deen</A>

</pre>
<hr>
<H2>PARAMETERS:</H2>
<HR><A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/marscorr_level2.html#inp"><H3>INP</H3></A>
input images.
first: left eye
second: right eye

<HR><A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/marscorr_level2.html#out"><H3>OUT</H3></A>
Output files
first: line disparity
second: sample disparity

<HR><A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/marscorr_level2.html#mask"><H3>MASK</H3></A>
Output <A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/marscorr_level2.html#mask">mask</A> file
(optional)

<HR><A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/marscorr_level2.html#out_quality"><H3>OUT_QUALITY</H3></A>
Output <A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/marscorr_level2.html#quality">quality</A> image
(optional)

<HR><A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/marscorr_level2.html#band"><H3>BAND</H3></A>
The vicar image 
<A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/marscorr_level2.html#band">band</A> number. 
Defaults to 1

<HR><A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/marscorr_level2.html#template"><H3>TEMPLATE</H3></A>
correlation size

<HR><A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/marscorr_level2.html#search"><H3>SEARCH</H3></A>
correlation <A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/marscorr_level2.html#search">search</A>
area

<HR><A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/marscorr_level2.html#quality"><H3>QUALITY</H3></A>
Minimum acceptable
correlation <A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/marscorr_level2.html#quality">quality</A>.

<HR><A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/marscorr_level2.html#tptlimit"><H3>TPTLIMIT</H3></A>
Limit number of
tiepoints to <A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/marscorr_level2.html#tptlimit">TPTLIMIT</A>

<HR><A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/marscorr_level2.html#seed"><H3>SEED</H3></A>
Starting tiepoint
location.
l,s,l,s

<HR><A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/marscorr_level2.html#seedfile"><H3>SEEDFILE</H3></A>
MARSTIE tiepoint file
with multiple seeds

<HR><A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/marscorr_level2.html#seedpair"><H3>SEEDPAIR</H3></A>
image numbers for
<A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/marscorr_level2.html#seedfile">seedfile</A> file

<HR><A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/marscorr_level2.html#amax"><H3>AMAX</H3></A>
Maximum <A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/marscorr_level2.html#template">template</A>/
<A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/marscorr_level2.html#search">search</A> areas

<HR><A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/marscorr_level2.html#mode"><H3>MODE</H3></A>
Correlation <A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/marscorr_level2.html#mode">mode</A>.
Use only amoeba,
amoeba2.

<HR><A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/marscorr_level2.html#data_set_name"><H3>DATA_SET_NAME</H3></A>
Specifies the full name given
to a data set or a data product.

<HR><A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/marscorr_level2.html#data_set_id"><H3>DATA_SET_ID</H3></A>
Specifies a unique alphanumeric
identifier for a data set or data
product.

<HR><A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/marscorr_level2.html#release_id"><H3>RELEASE_ID</H3></A>
Specifies the unique identifier
associated with the release to the
public of all or part of a data set.
The release number is associated with
the data set, not the mission.

<HR><A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/marscorr_level2.html#product_id"><H3>PRODUCT_ID</H3></A>
Specifies a permanent, unique
identifier assigned to a data
product by its producer.

<HR><A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/marscorr_level2.html#producer_id"><H3>PRODUCER_ID</H3></A>
Specifies the unique identifier
of an entity associated with the
production a data set.

<HR><A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/marscorr_level2.html#producer_inst"><H3>PRODUCER_INST</H3></A>
Specifies the full name of the
identity of an entity associated
with the production of a data set.

<HR><A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/marscorr_level2.html#target_name"><H3>TARGET_NAME</H3></A>
Specifies a target.

<HR><A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/marscorr_level2.html#target_type"><H3>TARGET_TYPE</H3></A>
Specifies the type of a named target.

<HR><A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/marscorr.html#examples"><H4>See Examples:</H4></A>
<HR><A HREF="/VICAR-DOCS/vicar/core510/html/vichelp/marscorr.html#CogProg"><H4>Cognizant Programmer:</H4></A>
</BODY>
</HTML>
